
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
  <meta http-equiv="Pragma" content="no-cache">
  <meta http-equiv="Expires" content="0">
  <title>5572 Scouting Site</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="match-data.js"></script>
  <style>
    body {
      background-color: rgb(232, 137, 137);
    }
    .form-row {
      display: flex;
      flex-wrap: wrap;
      gap: 20px;
      margin-bottom: 10px;
    }
    fieldset {
      width: 150px;
      padding: 10px;
      border: 2px solid #333;
      border-radius: 8px;
      background-color: white;
      height: min-content;
    }
    legend {
      font-weight: bold;
    }
    .success-message {
      display: none;
      position: fixed;
      top: 20px;
      right: 20px;
      z-index: 1000;
      background-color: #28a745;
      color: white;
      padding: 15px 25px;
      border-radius: 8px;
      box-shadow: 0 4px 8px rgba(0,0,0,0.2);
    }
    .error-message {
      display: none;
      position: fixed;
      top: 20px;
      right: 20px;
      z-index: 1000;
      background-color: #dc3545;
      color: white;
      padding: 15px 25px;
      border-radius: 8px;
      box-shadow: 0 4px 8px rgba(0,0,0,0.2);
    }
    .loading {
      opacity: 0.6;
      pointer-events: none;
    }
  </style>
</head>
<body>
<div class="container py-4">
  <h1 class="text-center mb-4"><img src="https://i.imgur.com/xqjJoxr.jpeg" alt="Online Photo" width="350" height="80" style="border: 2px solid black; border-radius: 12px;"> -      5572 Scouting Site     - <img src="https://i.imgur.com/OZ2d2KR.jpeg" alt="Online Photo" width="350" height="80" style="border: 2px solid black; border-radius: 12px;"></h1>
  
  <div id="successMessage" class="success-message">
    Form submitted successfully! Ready for next match.
  </div>

  <div id="errorMessage" class="error-message">
    Error loading match data. Please check event key and match number.
  </div>

  <form id="scoutingForm" action="https://docs.google.com/forms/d/e/1FAIpQLSd0aU5uxNdrizvRt6PZL4cgRauRL0xAC74xru5_cDiKKv6AXA/formResponse"
        method="POST" target="hidden_iframe">

    <h4>Pre-Match</h4>
    <div class="form-row">
      <fieldset>
        <legend>Your Full Name</legend>
        <input type="text" class="form-control persistent-field" name="entry.42633613" id="userName" placeholder="Enter your name" required>
      </fieldset>
       <fieldset>
        <legend>Lanyard Number</legend>
        <select class="form-select persistent-field" name="entry.452275389" id="lanyardNumber" required>
          <option value="" disabled selected>Select one</option>
          <option value="1">1</option>
          <option value="2">2</option>
          <option value="3">3</option>
          <option value="4">4</option>
          <option value="5">5</option>
          <option value="6">6</option>
        </select>
      </fieldset>
      <fieldset>
        <legend>Event: 2025txbel</legend>
        <input type="hidden" name="entry.1847537648" id="eventKey" value="2025txbel">
        <div class="form-control-static">Belton Event</div>
      </fieldset>
      <fieldset>
        <legend>Match Number</legend>
        <input type="number" class="form-control" name="entry.385793713" id="matchNumber" placeholder="Match #" required min="1" max="200">
      </fieldset>
      <fieldset>
        <legend>Team</legend>
        <select class="form-select" name="entry.1142161909" id="teamSelect" required disabled>
          <option value="" disabled selected>Select match first</option>
        </select>
        <small id="teamLoadingIndicator" class="form-text text-muted" style="display: none;">Loading teams...</small>
      </fieldset>
      <fieldset>
        <legend>Robot Attendance</legend>
        <select class="form-select" name="entry.942927237" required>
          <option value="" disabled selected>Select one</option>
          <option value="Present">Present</option>
          <option value="No Show">No Show</option>
        </select>
      </fieldset>
    </div>

    <h4>Auto</h4>
    <div class="form-row">
      <fieldset>
        <legend>Starting Location</legend>
        <select class="form-select" name="entry.1061926718" required>
          <option value="" disabled selected>Select one</option>
          <option value="S1">S1</option>
          <option value="S2">S2</option>
          <option value="S3">S3</option>
          <option value="S4">S4</option>
          <option value="S5">S5</option>
        </select>
      </fieldset>
      <fieldset>
        <legend>Exit Starting Area?</legend>
        <select class="form-select" name="entry.2011066249" required>
          <option value="" disabled selected>Select one</option>
          <option value="Yes">Yes</option>
          <option value="No">No</option>
          <option value="Don't know (unacceptable)">Don't know (unacceptable)</option>
        </select>
      </fieldset>
      <div class="form-row">
        <fieldset class="w-100">
          <legend>Where Robot Scored</legend>
          <div class="d-flex gap-5">
            <div>
              <label><input type="checkbox" name="entry.1189704345" value="A"> A</label><br>
              <label><input type="checkbox" name="entry.1189704345" value="B"> B</label><br>
              <label><input type="checkbox" name="entry.1189704345" value="C"> C</label><br>
              <label><input type="checkbox" name="entry.1189704345" value="D"> D</label><br>
              <label><input type="checkbox" name="entry.1189704345" value="E"> E</label><br>
              <label><input type="checkbox" name="entry.1189704345" value="F"> F</label><br>
            </div>
            <div>
              <label><input type="checkbox" name="entry.1189704345" value="G"> G</label><br>
              <label><input type="checkbox" name="entry.1189704345" value="H"> H</label><br>
              <label><input type="checkbox" name="entry.1189704345" value="I"> I</label><br>
              <label><input type="checkbox" name="entry.1189704345" value="J"> J</label><br>
              <label><input type="checkbox" name="entry.1189704345" value="K"> K</label><br>
              <label><input type="checkbox" name="entry.1189704345" value="L"> L</label><br>
            </div>
          </div>
        </fieldset>
      </div>
      <img src="https://i.imgur.com/3DbrkSJ.jpeg" alt="Online Photo" width="300" height="208" style="border: 2px solid black; border-radius: 12px;">
      <fieldset>
        <legend>Auto Processor</legend>
        <select class="form-select" name="entry.2051342965" required>
          <option value="" disabled selected>Select one</option>
          <option value="0">0</option>
          <option value="1">1</option>
          <option value="2">2</option>
          <option value="3">3</option>
          <option value="4">4</option>
          <option value="5">5</option>
          <option value="6">6</option>
          <option value="7">7</option>
          <option value="8">8</option>
        </select>
      </fieldset>
      <fieldset>
        <legend>Auto Net</legend>
        <select class="form-select" name="entry.1916771961" required>
          <option value="" disabled selected>Select one</option>
          <option value="0">0</option>
          <option value="1">1</option>
          <option value="2">2</option>
          <option value="3">3</option>
          <option value="4">4</option>
          <option value="5">5</option>
          <option value="6">6</option>
          <option value="7">7</option>
          <option value="8">8</option>
        </select>
      </fieldset>
      <fieldset>
        <legend>Auto L4</legend>
        <select class="form-select" name="entry.345642875" required>
          <option value="" disabled selected>Select one</option>
          <option value="0">0</option>
          <option value="1">1</option>
          <option value="2">2</option>
          <option value="3">3</option>
          <option value="4">4</option>
          <option value="5">5</option>
          <option value="6">6</option>
          <option value="7">7</option>
          <option value="8">8</option>
        </select>
      </fieldset>
      <fieldset>
        <legend>Auto L3</legend>
        <select class="form-select" name="entry.1951919616" required>
          <option value="" disabled selected>Select one</option>
          <option value="0">0</option>
          <option value="1">1</option>
          <option value="2">2</option>
          <option value="3">3</option>
          <option value="4">4</option>
          <option value="5">5</option>
          <option value="6">6</option>
          <option value="7">7</option>
          <option value="8">8</option>
        </select>
      </fieldset>
      <fieldset>
        <legend>Auto L2</legend>
        <select class="form-control" name="entry.1162467329" required>
          <option value="" disabled selected>Select one</option>
          <option value="0">0</option>
          <option value="1">1</option>
          <option value="2">2</option>
          <option value="3">3</option>
          <option value="4">4</option>
          <option value="5">5</option>
          <option value="6">6</option>
          <option value="7">7</option>
          <option value="8">8</option>
        </select>
      </fieldset>
      <fieldset>
        <legend>Auto L1</legend>
        <select class="form-select" name="entry.1430046888" required>
          <option value="" disabled selected>Select one</option>
          <option value="0">0</option>
          <option value="1">1</option>
          <option value="2">2</option>
          <option value="3">3</option>
          <option value="4">4</option>
          <option value="5">5</option>
          <option value="6">6</option>
          <option value="7">7</option>
          <option value="8">8</option>
        </select>
      </fieldset>
    </div>

    <h4>Teleop</h4>
    <div class="form-row">
      <fieldset>
        <legend>Teleop Processor</legend>
        <select class="form-select" name="entry.905449581" required>
          <option value="" disabled selected>Select one</option>
          <option value="0">0</option>
          <option value="1">1</option>
          <option value="2">2</option>
          <option value="3">3</option>
          <option value="4">4</option>
          <option value="5">5</option>
          <option value="6">6</option>
          <option value="7">7</option>
          <option value="8">8</option>
          <option value="9">9</option>
          <option value="10">10</option>
          <option value="11">11</option>
          <option value="12">12</option>
        </select>
      </fieldset>
      <fieldset>
        <legend>Teleop Net</legend>
        <select class="form-select" name="entry.550948513" required>
          <option value="" disabled selected>Select one</option>
          <option value="0">0</option>
          <option value="1">1</option>
          <option value="2">2</option>
          <option value="3">3</option>
          <option value="4">4</option>
          <option value="5">5</option>
          <option value="6">6</option>
          <option value="7">7</option>
          <option value="8">8</option>
          <option value="9">9</option>
          <option value="10">10</option>
          <option value="11">11</option>
          <option value="12">12</option>
        </select>
      </fieldset>
      <fieldset>
        <legend>Teleop L4</legend>
        <select class="form-select" name="entry.300837219" required>
          <option value="" disabled selected>Select one</option>
          <option value="0">0</option>
          <option value="1">1</option>
          <option value="2">2</option>
          <option value="3">3</option>
          <option value="4">4</option>
          <option value="5">5</option>
          <option value="6">6</option>
          <option value="7">7</option>
          <option value="8">8</option>
          <option value="9">9</option>
          <option value="10">10</option>
          <option value="11">11</option>
          <option value="12">12</option>
        </select>
      </fieldset>
      <fieldset>
        <legend>Teleop L3</legend>
        <select class="form-select" name="entry.54316812" required>
          <option value="" disabled selected>Select one</option>
          <option value="0">0</option>
          <option value="1">1</option>
          <option value="2">2</option>
          <option value="3">3</option>
          <option value="4">4</option>
          <option value="5">5</option>
          <option value="6">6</option>
          <option value="7">7</option>
          <option value="8">8</option>
          <option value="9">9</option>
          <option value="10">10</option>
          <option value="11">11</option>
          <option value="12">12</option>
        </select>
      </fieldset>
      <fieldset>
        <legend>Teleop L2</legend>
        <select class="form-select" name="entry.727030243" required>
          <option value="" disabled selected>Select one</option>
          <option value="0">0</option>
          <option value="1">1</option>
          <option value="2">2</option>
          <option value="3">3</option>
          <option value="4">4</option>
          <option value="5">5</option>
          <option value="6">6</option>
          <option value="7">7</option>
          <option value="8">8</option>
          <option value="9">9</option>
          <option value="10">10</option>
          <option value="11">11</option>
          <option value="12">12</option>
        </select>
      </fieldset>
      <fieldset>
        <legend>Teleop L1</legend>
        <select class="form-select" name="entry.598969573" required>
          <option value="" disabled selected>Select one</option>
          <option value="0">0</option>
          <option value="1">1</option>
          <option value="2">2</option>
          <option value="3">3</option>
          <option value="4">4</option>
          <option value="5">5</option>
          <option value="6">6</option>
          <option value="7">7</option>
          <option value="8">8</option>
          <option value="9">9</option>
          <option value="10">10</option>
          <option value="11">11</option>
          <option value="12">12</option>
        </select>
      </fieldset>
    </div>

    <h4>Scoring & Intake</h4>
    <div class="form-row">
      <fieldset>
        <legend>Scoring Method</legend>
        <select class="form-select" name="entry.1093979612" required>
          <option value="" disabled selected>Select one</option>
          <option value="April Tag (Can Shoot Anywhere)">April Tag (Can Shoot Anywhere)</option>
          <option value="Has To Line Up">Has To Line Up</option>
          <option value="Dosen't/Can't Score">Dosen't/Can't Score</option>
          <option value="Don't know (unacceptable)">Don't know (unacceptable)</option>
        </select>
      </fieldset>
      <fieldset>
        <legend>Coral Intake Method</legend>
        <select class="form-select" name="entry.1991747744" required>
          <option value="" disabled selected>Select one</option>
          <option value="Feeder Station">Feeder Station</option>
          <option value="Floor">Floor</option>
          <option value="Both">Both</option>
          <option value="None">None</option>
          <option value="Don't know (unacceptable)">Don't know (unacceptable)</option>
        </select>
      </fieldset>
      <fieldset>
        <legend>Algae Intake Method</legend>
        <select class="form-select" name="entry.1444682807" required>
          <option value="" disabled selected>Select one</option>
          <option value="Off the Reef">Off the Reef</option>
          <option value="Floor">Floor</option>
          <option value="Both">Both</option>
          <option value="None">None</option>
          <option value="Don't know (unacceptable)">Don't know (unacceptable)</option>
        </select>
      </fieldset>
    </div>

    <h4>Endgame</h4>
    <div class="form-row">
      <fieldset>
        <legend>Climb/Park</legend>
        <select class="form-select" name="entry.1908684697" required>
          <option value="" disabled selected>Select one</option>
          <option value="Deep Climb (Lower Cage) - Successful">Deep Climb (Lower Cage) - Successful</option>
          <option value="Shallow Climb (Higher Cage) - Successful">Shallow Climb (Higher Cage) - Successful</option>
          <option value="Attempted To Climb, Parked">Attempted To Climb, Parked</option>
          <option value="Attempted To Climb, No Park">Attempted To Climb, No Park</option>
          <option value="Just Parked">Just Parked</option>
          <option value="None/Did Not Attempt">None/Did Not Attempt</option>
        </select>
      </fieldset>
      <fieldset>
        <legend>Defense</legend>
        <select class="form-select" name="entry.1685817405" required>
          <option value="" disabled selected>Select one</option>
          <option value="1">1</option>
          <option value="2">2</option>
          <option value="3">3</option>
          <option value="4">4</option>
          <option value="5">5</option>
        </select>
      </fieldset>
      <fieldset>
        <legend>Driving</legend>
        <select class="form-select" name="entry.1362560271" required>
          <option value="" disabled selected>Select one</option>
          <option value="1">1</option>
          <option value="2">2</option>
          <option value="3">3</option>
          <option value="4">4</option>
          <option value="5">5</option>
        </select>
      </fieldset>
      <fieldset>
        <legend>Tipped?</legend>
        <select class="form-select" name="entry.616314965" required>
          <option value="" disabled selected>Select one</option>
          <option value="Yes">Yes</option>
          <option value="No">No</option>
          <option value="Almost">Almost</option>
        </select>
      </fieldset>
    </div>

    <div class="form-row">
      <fieldset class="w-100">
        <legend>Comments</legend>
        <input type="text" class="form-control" name="entry.904774817" placeholder="Type answer here" required>
      </fieldset>
    </div>

    <div class="form-row justify-content-center">
      <button type="submit" class="btn btn-primary">Submit!</button>
    </div>
  </form>

  <iframe name="hidden_iframe" style="display:none;" onload="handleFormSubmit()"></iframe>
</div>

<script>
  // Configuration - Change this line to set your event key
  const DEFAULT_EVENT_KEY = '2025txbel';
  
  let submitted = false;
  let matchData = null;

  // Load persistent data on page load
  window.addEventListener('load', function() {
    // Set the event key automatically
    document.getElementById('eventKey').value = DEFAULT_EVENT_KEY;
    
    loadPersistentData();
    initializeMatchNumber();
    
    // Try to load match data if available
    if (typeof window.MATCH_DATA !== 'undefined') {
      matchData = window.MATCH_DATA;
      console.log('Match data loaded:', matchData);
    } else {
      console.log('No match data found in match-data.js file');
    }
  });

  // Save persistent data when fields change
  document.addEventListener('change', function(e) {
    if (e.target.classList.contains('persistent-field')) {
      savePersistentData();
    }
    
    // Load teams when match number changes (event key is now fixed)
    if (e.target.id === 'matchNumber') {
      loadTeamsForMatch();
    }
  });

  // Also save on input for text fields
  document.addEventListener('input', function(e) {
    if (e.target.classList.contains('persistent-field')) {
      savePersistentData();
    }
  });

  function savePersistentData() {
    const persistentData = {};
    document.querySelectorAll('.persistent-field').forEach(field => {
      persistentData[field.id] = field.value;
    });
    
    // Also save current match number to help with auto-increment
    const matchNumber = document.getElementById('matchNumber').value;
    if (matchNumber) {
      persistentData.lastMatchNumber = parseInt(matchNumber);
    }
    
    // Using a simple variable instead of localStorage since it's not supported
    window.scoutingPersistentData = persistentData;
  }

  function loadPersistentData() {
    if (window.scoutingPersistentData) {
      Object.keys(window.scoutingPersistentData).forEach(fieldId => {
        if (fieldId !== 'lastMatchNumber') {
          const field = document.getElementById(fieldId);
          if (field) {
            field.value = window.scoutingPersistentData[fieldId];
          }
        }
      });
    }
  }

  function initializeMatchNumber() {
    const matchNumberField = document.getElementById('matchNumber');
    if (window.scoutingPersistentData && window.scoutingPersistentData.lastMatchNumber) {
      // If we have a previous match number, start with the next one
      matchNumberField.value = window.scoutingPersistentData.lastMatchNumber + 1;
    } else if (!matchNumberField.value) {
      // If no previous match and field is empty, start with 1
      matchNumberField.value = ;
    }
    
    // Load teams for current match
    loadTeamsForMatch();
  }

  function loadTeamsForMatch() {
    const eventKey = DEFAULT_EVENT_KEY; // Use the configured event key
    const matchNumber = parseInt(document.getElementById('matchNumber').value);
    const teamSelect = document.getElementById('teamSelect');
    const loadingIndicator = document.getElementById('teamLoadingIndicator');
    
    console.log('Loading teams for:', eventKey, 'match:', matchNumber);
    
    if (!matchNumber || isNaN(matchNumber)) {
      console.log('No valid match number provided');
      teamSelect.disabled = true;
      teamSelect.innerHTML = '<option value="" disabled selected>Enter match number first</option>';
      loadingIndicator.style.display = 'none';
      return;
    }

    // Show loading state
    loadingIndicator.style.display = 'block';
    teamSelect.disabled = true;
    teamSelect.innerHTML = '<option value="" disabled selected>Loading teams...</option>';

    // Try to get teams from local match data first
    if (matchData && matchData[eventKey] && matchData[eventKey][matchNumber]) {
      console.log('Found teams in local data:', matchData[eventKey][matchNumber]);
      populateTeamSelect(matchData[eventKey][matchNumber]);
      loadingIndicator.style.display = 'none';
      return;
    }

    console.log('No local data found for match', matchNumber, 'in event', eventKey);
    console.log('Available events in matchData:', matchData ? Object.keys(matchData) : 'No match data');
    if (matchData && matchData[eventKey]) {
      console.log('Available matches for', eventKey + ':', Object.keys(matchData[eventKey]));
    }
    
  }

  function populateTeamSelect(teams) {
    const teamSelect = document.getElementById('teamSelect');
    
    if (!teams || teams.length === 0) {
      teamSelect.innerHTML = '<option value="" disabled selected>No teams found</option>';
      teamSelect.disabled = true;
      return;
    }
    
    teamSelect.innerHTML = '<option value="" disabled selected>Select team</option>';
    
    teams.forEach(team => {
      const option = document.createElement('option');
      const teamNumber = typeof team === 'string' ? team.replace('frc', '') : team.number;
      //const alliance = team.alliance ? ` (${team.alliance})` : '';
      
      option.value = `${teamNumber}`;
      option.textContent = `${teamNumber}`; // Removed alliance display
      teamSelect.appendChild(option);
    });
    
    teamSelect.disabled = false;
  }

  function showErrorMessage() {
    const errorMessage = document.getElementById('errorMessage');
    errorMessage.style.display = 'block';
    
    setTimeout(() => {
      errorMessage.style.display = 'none';
    }, 5000);
  }

  function handleFormSubmit() {
    if (submitted) {
      // Show success message
      const successMessage = document.getElementById('successMessage');
      successMessage.style.display = 'block';
      
      setTimeout(() => {
        successMessage.style.display = 'none';
      }, 3000);

      // Save current match number before reset
      const currentMatchNumber = parseInt(document.getElementById('matchNumber').value) || 1;
      
      // Reset the form
      document.getElementById('scoutingForm').reset();
      
      // Restore the event key and persistent data
      document.getElementById('eventKey').value = DEFAULT_EVENT_KEY;
      loadPersistentData();
      
      // Set next match number
      document.getElementById('matchNumber').value = currentMatchNumber + 1;
      
      // Update stored match number
      if (window.scoutingPersistentData) {
        window.scoutingPersistentData.lastMatchNumber = currentMatchNumber;
      }
      
      // Load teams for new match
      loadTeamsForMatch();
      
      submitted = false;
    }
  }

  // Handle form submission
  document.getElementById('scoutingForm').addEventListener('submit', function() {
    submitted = true;
    savePersistentData();
  });
</script>
<script src="
